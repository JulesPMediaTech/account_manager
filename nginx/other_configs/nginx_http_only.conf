# Use this configuration for HTTP only (no HTTPS)

events {
   worker_connections 1024;
}


http {
   # MIME types - required for CSS/JS to work
   include /etc/nginx/mime.types;
   default_type application/octet-stream;


   # Rate limiting - must be in http block
   limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s;


   upstream my_app {
       server accmanager_service:8000; # Use the internal container port
   }	


   server {
       listen 80;
       server_name 192.168.x.x; 	# Your IP


       # Security headers
       add_header X-Frame-Options "SAMEORIGIN" always;
       add_header X-Content-Type-Options "nosniff" always;
       add_header X-XSS-Protection "1; mode=block" always;


       location / {
           # Apply rate limit here
           limit_req zone=one burst=20;
          
           proxy_pass http://my_app;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }


       # Serve static files directly
       location /static/ {
           alias /app/static/;
           expires 30d;
       }
   }
}
